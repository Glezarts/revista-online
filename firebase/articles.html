<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Articles</title>
  <style>
    *{
      font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
    }
    body{
background-color: #08103E;
    }
    h1,p{
      text-align: center;
    }
    .content{
      display: flex;
      flex-direction: column;
      justify-content: center;
      margin:auto;
      background-color:white;
      padding: 20px 50px;
    }
    .contenidor{
      width: 1000px;
    }
    .contCheckbox{
      width: 1000px;
 
    }

  </style>
</head>
<link rel="stylesheet" href="firebase.css">
<body>
 

  <!--** Falta fer una llegenda on ells puguin fer una mica d'estil (cursiva, negreta i 2 mides de text. I llista. ) -->

  <div class="content">
    <header>
      <h1>Escriviu aquí els vostres articles</h1>
      <p>El contingut que escriviu en aquest document s'actualitzarà en la web. 
      </p>
      </header>
  	<div class="contenidor">
  	  <label for="title"><span class="italic">Escriviu aquí la capçalera o títol de l'article</span></label>
  	  <input type="text" name="titol" id="titol" placeholder="títol de l'article">
  	</div>
  	<div class="contenidor">
  	  <label for="contingut"><span class="italic">Escriviu aquí el contingut de l'article</span></label>
  	  <textarea name="contingut" id="contingut" cols="150" rows="30" placeholder="Escriviu el contingut"></textarea>
  	</div>
  	<p><span class="italic">Trieu la categoria de l'article // secció a la qual correspon. Pot ser més de una.</span> </p>
  	<div class="contCheckbox">
  	  <label  class="contenidorCheckbox"><b>General (Inicio)</b>
  	    <input type="checkbox" checked="checked">
  	  </label>
      <label  class="contenidorCheckbox"><b>Actualitat</b>
  	    <input type="checkbox">
  	  </label>
      <label  class="contenidorCheckbox"><b>Entrevista</b>
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Albania
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Alemanya
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Armènia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Austràlia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Àustria
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Azerbaijan
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Bielorússia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Bèlgica
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Bòsnia i Hercegovina
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Bulgària
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Croàcia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Dinamarca
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Estònia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Eslovàquia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Eslovènia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Espanya
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Finlàndia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">França
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Geòrgia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Grècia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Hongria
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Islàndia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Irlanda
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Israel
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Itàlia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Letònia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Lithuania
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Malta
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Moldàvia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Montenegro
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Països Baixos
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Macedònia del Nord
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Noruega
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Polònia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Portugal
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Regne Unit
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">República Txeca
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Romania
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Russia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">San Marino
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Sèrbia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Suècia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Suïssa
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Ucraïna
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Turquia
  	    <input type="checkbox">
  	  </label>
  	  <label  class="contenidorCheckbox">Xipre
  	    <input type="checkbox">
  	  </label>
  	</div>
  </div>
  
  <div class="divImatge">
    <progess value="0" max="100" id="uploader">0%</progess>
    <input type="file" value="upload" id="fileButton" />
  </div>
  
  <button id="btn" >Send</button>
  
  <!-- <script src="firebase.js"></script> -->
  
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
  
  
  <script src="https://www.gstatic.com/firebasejs/8.2.6/firebase-storage.js"></script>
  
  <script src="https://www.gstatic.com/firebasejs/8.2.6/firebase-database.js"></script>
  <!-- TODO: Add SDKs for Firebase products that you want to use
    https://firebase.google.com/docs/web/setup#available-libraries -->
    
    <script>

          const URL = "https://eurovisiu-default-rtdb.firebaseio.com/articles";
          
          
          
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyA5-G20uoAdIfb74mdV-pz4DMuZNLoF1kE",
        authDomain: "eurovisiu.firebaseapp.com",
        databaseURL: "https://eurovisiu-default-rtdb.firebaseio.com",
        projectId: "eurovisiu",
        storageBucket: "eurovisiu.appspot.com",
        messagingSenderId: "477526781890",
        appId: "1:477526781890:web:5a04cbca39bd25acbeb05b"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      
      // Get elements
      var uploader = document.querySelector("#uploader");
      var fileButton = document.querySelector("#fileButton");
      var send = document.querySelector("#btn");
      
      // Listen for file selection
      // fileButton.addEventListener("change", function(e) {
        send.addEventListener("click", function(e) {
          // Get values
          let ti = document.querySelector("#titol").value;
          let cont = document.querySelector("#contingut").value;
          let cb = document.querySelectorAll(".cb");

          // Get file
          // var file = e.target.files[0];
          var file = fileButton.files[0];
          var fileName = new Date().getTime()  + file.name; 
          console.log('funciona');
          
          // Create a storage ref
          var storageRef = firebase.storage().ref('articles/' + fileName);
          // Update file
          var task = storageRef.put(file);
          
          

          // DATABASE
          var databaseRef = firebase.database().ref('articles/');
          var objecte = getValues();
          objecte.img = fileName; 
          databaseRef.push(objecte); 

          
          
          
          // Function para obtener los valores introducidos por el usuario
          function getValues(){
            let sec= [];
            for (var checkbox of cb) {  
              if (checkbox.checked){  
                sec.push(checkbox.closest("label").innerText);
              }  
            }
            return {titol: ti, contingut: cont, seccions: sec};
          }
          
          
          
          
          // Update progress bar
          // task.on('state_changed', 
          
          //   function progress(snapshot) {
            //     var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            //     uploader.value = percentage;
            //   },
            //   function error(err) {
              
              //   },
              //   function complete() {
                
                //   }
                
                // );
              });
              
              
            </script>
            
            
            
          </body>
          </html>